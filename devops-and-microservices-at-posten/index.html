<!doctype html>
<!-- vim: set tabstop=4 shiftwidth=4 noexpandtab: -->
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>DevOps og Micro Services hos Posten</title>

		<meta name="description" content="DevOps og Micro Services hos Posten">
		<meta name="author" content="Stian Mathiassen and J√∏ran Lillesand">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/bekk.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<div class="slides">
				<section id="avklaringer">
					<ul>
						<li>Er "den r√∏de tr√•den" litt for springende? Er det vanskelig √• f√∏lge flyten og hva vi snakker om?</li>
					</ul>
				</section>


				<section id="intro-speakers">
					<section>
						<h2>DevOps og Microservices hos Posten og Bring!</h2>
					</section>

					<section>
						<h1>Hvem er vi?</h1>
						<div style="clear:both"></div>

						<div style="width: 49%; float: left;">
							<img src="img/hovercat.jpg" />
							<div class="illustrationCircle backgroundColor-red">
								<p class="illustrationCircle-text">Stian</p>
							</div>
						</div>
						<div style="width: 49%; float: left;" class="fragment">
							<img src="img/lillesand.jpeg" />
							<div class="illustrationCircle backgroundColor-red">
								<p class="illustrationCircle-text">J√∏ran</p>
							</div>
						</div>
					</section>

					<aside class="notes">
						Typ: 30 sek hver.
						Bittekort bio om hver av oss. Hva gj√∏r vi her? Bakgrunn osv.
						Forslag til twist: bytt om bilde og navn! Sjekk om folk f√∏lger med! Hoho!
					</aside>
				</section>

				<section id="premisser">
					<section>
						Vi skal ikke introdusere DevOps, men‚Ä¶

						<aside class="notes">
							Det vi snakker om her fordrer at det interesse ‚Äì eller p√• et eller annet niv√• mulighet for ‚Äì √• integrere eller smelte sammen drifts- og utviklingsorganisasjonen. Det <i>er</i> vanskelig, men det er - etter v√•r mening - et premiss for √• lykkes med drift.
						</aside>
					</section>

					<section>
						Tilstanden til driftede produksjonsmilj√∏er
						<div class="emoticon" style="font-size: 250px;">üí©</div>

						<aside class="notes">
							<ul>
								<li>Marginene p√• √• selge drift er kn√∏ttsm√•</li>
							</ul>
						</aside>
					</section>

					<section>
						Stian finner bilde av en app p√• to hester samtidig
						http://a.abcnews.com/images/US/ht_jean_claude_van_damme_volvo_truck_split_ll_131115_16x9_992.jpg

						<aside class="notes">
							TODO: hva var bakgrunnen for denne metaforen igjen?
						</aside>
					</section>

					<section>
						<h2>Du tror du har‚Ä¶</h2>
						<ul>
							<li>Backup</li>
							<li>Overv√•kning</li>
							<li>Sikkerhet</li>
							<li>Likt konfigurte servere</li>
							<li>Mulighet til √• restore servere</li>
						</ul>
					</section>
				</section>

				<section id="intro">
					<section>
						Fullskjermbilde av Posten og Bring (ta noe reklamemateriell)

						<aside class="notes">
							Introduksjon av Posten/Bring. Keep it short.

							<ul>
								<li>Alle vet hvem Posten er.</li>
								<li>IT i Posten: Posten er, som mange andre, i stadig st√∏rre grad en it-virksomhet</li>
								<li>Si noe om st√∏rrelsen p√• IT i Posten</li>
								<li>En del vekst gjennom oppkj√∏p: typisk kj√∏per seg inn i nye markeder. Bud, Cargo, osv.</li>
								<li>Noe standardprodukt, noe tilpasning, noe skredders√∏m.</li>
							</ul>
						</aside>
					</section>

					<section>
						Bring Web Team (finn passende bilde)

						<aside class="notes">
							Om teamet:

							<ul>
								<li>Sped begynnelse i 2008. J√∏ran rett ut fra NTNU som f√∏rste utvikler. Det f√∏rste jeg gjorde var √• designe et gigantisk databaseskjema som heldigvis aldri ble brukt.</li>
								<li>Premisset for teamet: smidig! Endre m√•ten Posten gj√∏r software p√•.</li>
							</ul>
						</aside>
					</section>

					<section>
						Hva lager vi?

						<aside class="notes">
							<ul>
								<li>F√• med litt om hvilke tjenester vi har ansvaret for. Dropp et par navn, men fokuser prim√¶rt p√• √• vise at det ikke bare er noe sm√•tt t√∏yesri.</li>
								<li>Brukstall</li>
								<li>Omsetningstall</li>
								<li>Dette er ikke et rent tech-milj√∏, men forretningskritiske systemer.</li>
							</ul>

						</aside>
					</section>

					<section>
						TODO: Screenshots som viser en del av de fete tingene vi har.
						Hvor er vi?

						<aside class="notes">
							Fang oppmerksomheten s√•nn at folk v√•kner opp.


							Vi er stolte over hvor langt vi har kommet. Full buzzword compliance:
							<ul>
								<li>instrumentering med Puppet<li>
								<li>nedetidsfri deployment p√• dagtid</li>
								<li>Automatisert overv√•kning av logger basert p√• terskelverdier</li>
								<li>Logaggregering</li>
							</ul>

							Dette er fortellingen om reisen dit, og hvilke lekser vi har l√¶rt p√• veien.<br>
							Vi tror mye av det vi har l√¶rt er universelt. Tenk p√• hvor din organisasjon er i dag, og se hvilke steg vi har tatt derfra.
						</aside>
					</section>

					<section>
						TODO: Ta med slide eller ikke?
						Sp√∏rsm√•l?

						<aside class="notes">
							Ikke v√¶r redd for √• stille sp√∏rsm√•l! Det er ikke alt vi kan svare p√•, men ikke v√¶r redd for √• sp√∏rre.
							Hvis du lurer p√• noe er det sikkert flere som lurer p√• det samme.

							Sp√∏r underveis eller heng igjen etterp√•!
						</aside>
					</section>
				</section>


				<section id="hovedpoeng-teaser">
					<section>
						Konklusjonen
					</section>

					<section>
						L√∏s problemer du faktisk har.
					</section>
				</section>


				<section id="smidig">
					<section>
						Den spede begynnelsen!
					</section>

					<section>
						Smidig deployment

						<aside class="notes">
							Finn et bilde som illustrerer en gammel server

							<ul>
								<li>Gjorde smidig til tross for at det ikke var plass til √• gj√∏re smidig</li>
								<li>Hadde ingen tilgang til egne QA- eller prodservere</li>
								<li>Alle endringer disse milj√∏ene m√•tte bestilles gjennom et ITIL-regime</li>
								<li>Endte opp med √• bestille prodsettinger up front: annenhver uke, med mest mulig fleks i n√•r de skulle gj√∏res</li>
							</ul>
						</aside>
					</section>

					<section data-slide-type="poeng">
						Organisasjonen din er neppe klar for smidig. V√¶r en organisasjon i organisasjonen!

						<aside class="notes">
							Det er alltid utfordringer med det vi √∏nsker √• gj√∏re. Where there's a will there's a way.
							Det var mange som var uenige i det vi gjorde, og vi gjorde mye vi egentlig ikke skulle.
						</aside>
					</section>

					<section>
						Teamet har g√•tt fra 2-3 utviklere som sendte WAR-filer til en dedikert driftsleverand√∏r til √• kj√∏re
						full DevOps med virtualisert infrastruktur.

						<ul>
							<li>Lite smidig organisasjon</li>
							<li>Deler av organisasjonen hadde begynt f√∏le smerten</li>
							<li>Andre deler var godt forn√∏yd med og satt i tingens tilstand</li>
						</ul>
					</section>
				</section>

				<section id="egen-deploy">
					<section>
						Ville ha mer kontroll p√• hvordan deployment fungerte, siden vi brukte mye tid per deploy. Bestilte egne servere, og begynte √• automatisere deployment, og byttet ut stor appserver med liten container. Pr√∏ver ut p√• en (liten) app.
					</section>

					<section>
						Videre gikk p√• noen problemer mens dette milj√∏et var i startgropa. L√¶rte mye om drift og at dette faktisk er et fag i seg selv. √Ö ta ansvar for driftsmilj√∏ krever mye kunnskap om infrastruktur osv. Et eksempel p√• en mindre smart ting vi gjorde var √• eksplodere war-fila v√•r i tmp-folderen som blir wipa regelmessig av OSet. Ikke smart.
					</section>

					<section data-slide-type="tabbe">
						Embedded jetty med en war-fil inne i jaren som pakkes ut. I /tmp/.
					</section>

					<section>
						TODO: Finn stacktrace med file not found for en jsp-fil
					</section>

					<section data-slide-type="poeng">
						Start med noe sm√•tt med lav risiko. Du har fortsatt mye √• l√¶re!

						<aside class="notes">
							<ul>
								<li>Vi begynte med helt ny applikasjon</li>
								<li>Det viktigste er at kompleksiteten i applikasjonen er lav</li>
								<li>‚Ä¶ og at risikoen er lav. Folk b√∏r ikke miste jobben dersom det gj√∏res feil i starten.</li>
							</ul>
						</aside>
					</section>

					<section data-slide-type="visdomsord">
						Det finnes ingen Smidig uten kontinuerlige leveranser
					</section>
				</section>

				<section id="nedetidsfri-deploy">
					<section>
						Etterhvert som infrastrukturen vi driftet selv vokste og ble mer stabilt √∏kte hyppigheten p√• deploys veldig, og vi begynte fort √• kjenne smerten ved at deployments medf√∏rte nedetid og var noe omfattende. Her begynte salg og marked √• merke at dette milj√∏et var noe annet enn de hadde fra f√∏r, og vi begynte √• migrere gamle applikasjoner over p√• den nye, smidige infrastrukturen.

						<aside class="notes">
							Unng√• single point of failures , komponenter som ikke kan deployes uten nedetid
						</aside>
					</section>

					<section data-slide-type="tabbe">
						Appene vokste. Hyppige deployments. M√•tte deploye p√• kveldstid med manuelle steg for √• sikre at applikasjonen ikke ble utilgjengelig for brukerne.

						<aside class="notes">
							Diskuter hvordan dette ogs√• gjelder infrastruktur. Vi satt en hel fredags kveld for √• oppgradere MySQL √©n minorversjon.
						</aside>
					</section>

					<section data-slide-type="poeng">
						Rigg for nedetidsfri deployment

						<aside class="notes">
							N√•r applikasjoene deployes ofte begynner det snart √• gj√∏re vondt dersom det f√∏rer med seg nedetid. Dette b√∏r v√¶re et prinsipp for alle applikasjoner som inng√•r, inkludert databasen.
						</aside>
					</section>

					<section>
						TODO: Dette er enkelt for webapps, men en j√¶vla pandoras shitbox for persistent state.
					</section>
				</section>


				<section id="automatisering">
					<section>
						_Alle_ operasjoner som er n√∏dvendig for drift b√∏r automatiseres
					</section>

					<section data-slide-type="tabbe">
						Hadde begynt √• automatisere s√• sm√•tt, men mye manglet. Produksjonssatte bugga versjon av booking. Skulle rulle tilbake
						`ln -sf booking.jar booking-2.11.jar`
						`ln -sf booking-2.11.jar booking.jar`

						<aside class="notes">
							Hva er riktig syntax for symlink?
						</aside>
					</section>

					<section data-slide-type="tabbe">
						`be rake production:rollback`
						- not implemented
					</section>

					<section data-slide-type="poeng">
						Automatiser alt som skal gj√∏res i produksjon. Manuelle operasjoner b√∏r v√¶re et absolutt unntak.
					</section>
				</section>

				<section id="overv√•kning">
					<section>
						Overv√•kning er vanskelig!

						<aside class="notes">
							Har du 24/7 beredskap? Trenger du det? Har du egentlig?
						</aside>
					</section>

					<section>
						TODO: Problem.

						Applikasjoner som g√•r ned uten at vi merker det.
					</section>

					<section>
						TODO: Poeng

						Riktig niv√• p√• logging, riktig niv√• p√• alarmer som g√•r. Den personen som f√•r alarmen m√• kjenne applikasjonen og ha mulighet til √• gj√∏re tilpasninger.

						Bruk Digipost sine erfaringer her
					</section>

				</section>

				<section id="l√¶r-drift">
					<section>
						Mens vi stadig migrerte mer kritiske applikasjoner over p√• ny infrastruktur som vi driftet selv, ble vi tvunget til √• se i √∏yene at drift faktisk er et fagfelt. Vi gikk p√• flere smeller med backup, overv√•kning, hardening og s√• videre. Det som er interessant √• se i ettertid er hvordan v√•re l√∏sninger p√• konkrete problemer har ledet oss til infrastruktur som er helt i henhold til det som beskrives i DevOps-litteratur ‚Äì med noen interessante unntak.
					</section>

					<section data-slide-type="tabbe">
						Tok litt tid f√∏r vi etablerte mye av det som kommer "ut av boksen" n√•r man kj√∏per ferdig drift. Backup, overv√•kning, hardening av hosts. Men, v√¶r ogs√• klar over: mange driftsleverand√∏rer leverer dette. Men er du sikker p√• at det funker?
					</section>

					<section data-slide-type="poeng">
						Det er mye du skal kunne for √• gj√∏re drift riktig. Hvis du er ren utvikler er det stor sjanse for at du ikke kan det.

						<aside class="notes">
							Alt kan l√¶res!
							<ul>
								<li>Sikkerhet: OS-hardening</li>
								<li>Sonemodeller</li>
								<li>Virtualisering</li>
								<li>Nettverk</li>
								<li>Backup</li>
								<li>Overv√•kning</li>
							</ul>
						</aside>
					</section>
				</section>


				<section id="micro-services-the-beginning">
					<section>
						N√•r store applikasjoner ble flyttet merket vi smerten ved store applikasjoner bedre. Det er en ting √• deploye en lettbent, liten applikasjon ofte, men n√•r beistet begynner √• bli mange hundre tusen kodelinjer er det ikke like g√∏y. Uten at vi hadde ord for det vi drev p√• med, begynte vi √• fokusere p√• √• bryte opp funksjonalitet og unng√• √• la de store appene v√•re vokse videre.
					</section>

					<section>
						Begynte √• dele opp applikasjoner
					</section>

					<section data-slide-type="tabbe">
						Applikasjoner som ble s√• store at utviklingen begynte √• g√• tregere
					</section>

					<section data-slide-type="poeng">
						En applikasjon skal gj√∏re √©n ting. Se etter muligheten for √• lage egne applikasjoner av ting som vokser i sin egen retning.

						<aside class="notes">
							<ul>
								<li>Vurd√©r om vi skal snakke om hva som er riktig st√∏rrelse p√• en micro service.</li>
								<li>Er det riktig √• skille ut funksjonaliteten? Dette kommer an p√• flere faktorer, inkludert endringstakt av koden.</li>
								<li>Arkitektur er ikke et m√•l i seg selv!!</li>
							</ul>
						</aside>
					</section>

					<section data-slide-type="visdomsord">
						Micro Services er en konsekvens av DevOps

						<aside class="notes">
							Det er omvendt korrelasjon mellom st√∏rrelsen p√• applikasjonen og hvor ofte de kan deployes. Interessant kausalitet, fordi det driver hverandre begge veier.
						</aside>
					</section>
				</section>

				<section id="devops-er-en-markedsfordel">
					<section>
						Etterhvert som stadig flere applikasjoner begynte salgsorganisasjonen √• irritere seg over at endringer p√• noen applikasjoner kunne komme ut p√• under en dag, mens andre kunne ta opp til flere uker. Hvorfor m√•tte det v√¶re s√•nn!? Det endte med at Salg finansierte migreringen av resten av portef√∏ljen over p√• den nye infrastrukturen. Dette ble p√• mange m√•te en √∏ye√•pner for resten av organisasjonen, som inns√• at infrastruktur er for flere enn IT.
					</section>

					<section data-slide-type="smerte">
						Finansiering :(

						<aside class="notes">
							<ul>
								<li>"De h√∏ye herrer" i IT s√• ikke nytten med at vi kasta masse penger p√• √• drive infrastrukturen p√• annen m√•te enn de var vant til. Hvorfor skulle de betale for √• vi skulle l√∏se samme problem som driftsleverand√∏ren?</li>
								<li>Endte med at salgsorganisasjonen betalte for √• migrere resten av appene over p√• det "smidige driftsmilj√∏et"</li>
							</ul>
						</aside>
					</section>

					<section data-slide-type="poeng">
						S√∏rg for at forretning ser og f√•r cashet ut verdien av de tekniske forbedringene!

						<aside class="notes">
							Synliggj√∏r verdien av IT-oppgavene for andre enn IT. Sparer du penger? Kortere time to market? Vis og bevis det! Har det ingen effekt som er synlig for andre enn IT? B√∏r du egentlig gj√∏re det da..?
						</aside>
					</section>
				</section>

				<section id="industrialisering">
					<section>
						Ut fra de erfaringene vi gjorde oss, ble stadig mindre applikasjoner en naturlig f√∏lge. Kostnaden per applikasjon ble drevet ned, men med kj√∏pet fikk vi annen type kompleksitet enn vi var vant til. Applikasjonsutvikling og -drift m√•tte industrialiseres, og vi gikk inn i microservice-tidsalderen. Vi l√¶rte at vi trengte logaggregering, monitorering, isolasjon mellom applikasjoner, automatisk failover for kritisk funksjonalitet, valg av desentraliserte teknologier som OAuth for kjernekomponenter og mye annet.

						<aside class="notes">
							Micro service f√∏rer til industrialisering
						</aside>
					</section>

					<section data-slide-type="smerte">
						
						<aside class="notes">
							Det ble veldig komplekst √• deploye en app. M√•tte f√∏lge med i 4 fire logger p√• 2 servere samtidig!
							<br/>
							Var vanskelig √• gj√∏re drift, for milj√∏et begynte √• bli komplekst.
						</notes>
					</section>

					<section data-slide-type="poeng">
						Investere mer i infrastrukturen og drift av den. Automatiserte ikke lengre eksplisitte oppgaver, men mer implisitte oppgaver. (Logger, overv√•king, helsesjekker, osv)
						TODO: Screenshot av logging fra 2 instanser av 4 applikasjoner samtidig som det deployes
					</section>
				</section>

				<section id="hovedpoeng">
					<section>
						<ul>
							<li>Gj√∏r √©n forbedring om gangen</li>
							<li>L√∏s problemer n√•r du har dem</li>
							<li>Gj√∏r ting enkelt!</li>
						</ul>

						<aside class="notes">
							TODO: Finn ut hvordan vi strukturerer disse. Egne slides per poeng?<br/>

							Du kan ikke "implementere DevOps" eller "lage micro services". Dette er noe som m√• vokse frem organisk gjennom at et ansvarliggjort team f√∏ler p√• smerter og har lov til √• lage l√∏sninger. Ikke bygg platform for √• bygge platform!
						</aside>
					</section>
				</section>



				<section id="oppsummering">
					<section>
						Oppsumm√©r poengene som har v√¶rt gjort s√• langt.
					</section>
				</section>


				<section id="ideer/backup">
					<ul>
						<li>√òv p√• feilsituasjoner ‚Äì firedrills</li>
						<li>Sikkerhet! Med st√∏rre frihet kommer st√∏rre ansvar.</li>
						<li>Hvor micro er en microservice?</li>
					</ul>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
