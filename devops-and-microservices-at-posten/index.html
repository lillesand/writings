<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>DevOps og Micro Services hos Posten</title>

		<meta name="description" content="DevOps og Micro Services hos Posten">
		<meta name="author" content="Stian Mathiassen and Jøran Lillesand">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<div class="slides">
				<section id="intro">
					<section>
						Teamet har gått fra 2-3 utviklere som sendte WAR-filer til en dedikert driftsleverandør til å kjøre full DevOps med virtualisert infrastruktur, instrumentering med Puppet, nedetidsfri deployment på dagtid, logaggregering med Logstash og full buzzwordbonanza.

						<ul>
							<li>Lite smidig organisasjon</li>
							<li>Deler av organisasjonen hadde begynt føle smerten</li>
							<li>Andre deler var godt fornøyd med og satt i tingens tilstand</li>
						</ul>
					</section>
					<section data-slide-type="poeng">
						Organisasjonen din er neppe klar for smidig. Vær en organisasjon i organisasjonen!
					</section>
				</section>

				<section id="begynnelsen">
					<section>
						Ville ha mer kontroll på hvordan deployment fungerte, siden vi brukte mye tid per deploy. Bestilte egne servere, og begynte å automatisere deployment, og byttet ut stor appserver med liten container. Prøver ut på en (liten) app.
					</section>

					<section>
						Videre gikk på noen problemer mens dette miljøet var i startgropa. Lærte mye om drift og at dette faktisk er et fag i seg selv. Å ta ansvar for driftsmiljø krever mye kunnskap om infrastruktur osv. Et eksempel på en mindre smart ting vi gjorde var å eksplodere war-fila vår i tmp-folderen som blir wipa regelmessig av OSet. Ikke smart.
					</section>

					<section data-slide-type="tabbe">
						Embedded jetty med en war-fil inne i jaren som pakkes ut. I /tmp/.
					</section>

					<section>
						TODO: Finn stacktrace med file not found for en jsp-fil
					</section>

					<section data-slide-type="poeng">
						Start med noe smått med lav risiko. Du har fortsatt mye å lære!

						<aside class="notes">
							<ul>
								<li>Vi begynte med helt ny applikasjon</li>
								<li>Det viktigste er at kompleksiteten i applikasjonen er lav</li>
								<li>… og at risikoen er lav. Folk bør ikke miste jobben dersom det gjøres feil i starten.</li>
							</ul>
						</aside>
					</section>
				</section>

				<section id="nedetidsfri-deploy">
					<section>
						Etterhvert som infrastrukturen vi driftet selv vokste og ble mer stabilt økte hyppigheten på deploys veldig, og vi begynte fort å kjenne smerten ved at deployments medførte nedetid og var noe omfattende. Her begynte salg og marked å merke at dette miljøet var noe annet enn de hadde fra før, og vi begynte å migrere gamle applikasjoner over på den nye, smidige infrastrukturen.
					</section>

					<section data-slide-type="tabbe">
						Appene vokste. Hyppige deployments. Måtte deploye på kveldstid med manuelle steg for å sikre at applikasjonen ikke ble utilgjengelig for brukerne.
					</section>

					<section data-slide-type="poeng">
						Rigg for nedetidsfri deployment

						<aside class="notes">
							Når applikasjoene deployes ofte begynner det snart å gjøre vondt dersom det fører med seg nedetid. Dette bør være et prinsipp for alle applikasjoner som inngår, inkludert databasen.
						</aside>
					</section>
				</section>


				<section id="automatisering">
					<section>
						_Alle_ operasjoner som er nødvendig for drift bør automatiseres
					</section>

					<section data-slide-type="tabbe">
						Hadde begynt å automatisere så smått, men mye manglet. Produksjonssatte bugga versjon av booking. Skulle rulle tilbake
						`ln -sf booking.jar booking-2.11.jar`
						`ln -sf booking-2.11.jar booking.jar`

						<aside class="notes">
							Hva er riktig syntax for symlink?
						</aside>
					</section>

					<section data-slide-type="tabbe">
						`be rake production:rollback`
						- not implemented
					</section>

					<section data-slide-type="poeng">
						Automatiser alt som skal gjøres i produksjon. Manuelle operasjoner bør være et absolutt unntak.
					</section>
				</section>


				<section id="micro-services-the-beginning">
					<section>
						Når store applikasjoner ble flyttet merket vi smerten ved store applikasjoner bedre. Det er en ting å deploye en lettbent, liten applikasjon ofte, men når beistet begynner å bli mange hundre tusen kodelinjer er det ikke like gøy. Uten at vi hadde ord for det vi drev på med, begynte vi å fokusere på å bryte opp funksjonalitet og unngå å la de store appene våre vokse videre.
					</section>

					<section>
						Begynte å dele opp applikasjoner
					</section>

					<section data-slide-type="tabbe">
						Applikasjoner som ble så store at utviklingen begynte å gå tregere
					</section>

					<section data-slide-type="poeng">
						En applikasjon skal gjøre én ting. Se etter muligheten for å lage egne applikasjoner av ting som vokser i sin egen retning.
					</section>
				</section>


				<section>
					<section>
						Når store applikasjoner ble flyttet merket vi smerten ved store applikasjoner bedre. Det er en ting å deploye en lettbent, liten applikasjon ofte, men når beistet begynner å bli mange hundre tusen kodelinjer er det ikke like gøy. Uten at vi hadde ord for det vi drev på med, begynte vi å fokusere på å bryte opp funksjonalitet og unngå å la de store appene våre vokse videre.
					</section>

					<section data-slide-type="tabbe">
						TODO
					</section>

					<section data-slide-type="poeng">
						TODO
					</section>
				</section>


				<section>
					<section>
						Mens vi stadig migrerte mer kritiske applikasjoner over på ny infrastruktur som vi driftet selv, ble vi tvunget til å se i øyene at drift faktisk er et fagfelt. Vi gikk på flere smeller med backup, overvåkning, hardening og så videre. Det som er interessant å se i ettertid er hvordan våre løsninger på konkrete problemer har ledet oss til infrastruktur som er helt i henhold til det som beskrives i DevOps-litteratur – med noen interessante unntak.
					</section>

					<section data-slide-type="tabbe">
						TODO
					</section>

					<section data-slide-type="poeng">
						TODO
					</section>
				</section>

				<section>
					<section>
						Ut fra de erfaringene vi gjorde oss, ble stadig mindre applikasjoner en naturlig følge. Kostnaden per applikasjon ble drevet ned, men med kjøpet fikk vi annen type kompleksitet enn vi var vant til. Applikasjonsutvikling og -drift måtte industrialiseres, og vi gikk inn i microservice-tidsalderen. Vi lærte at vi trengte logaggregering, monitorering, isolasjon mellom applikasjoner, automatisk failover for kritisk funksjonalitet, valg av desentraliserte teknologier som OAuth for kjernekomponenter og mye annet.
					</section>

					<section data-slide-type="tabbe">
						TODO
					</section>

					<section data-slide-type="poeng">
						TODO
					</section>
				</section>

				<section>
					<section>
						Logaggregering
					</section>

					<section data-slide-type="tabbe">
						TODO: Screenshot av logging fra 2 instanser av 4 applikasjoner samtidig som det deployes
					</section>
				</section>




				<section id="oppsummering">
					<section>
						Oppsummér poengene som har vært gjort så langt.
					</section>

					<section>
						Poenger vi har notert. Sjekk om alt dette er med i timeline, og hvis ikke: bør det være det?

						* Gjør ting gradvis! Ikke implementer det boka sier du skal gjøre, men løs det problemet du faktisk har. Men se hva boka sier du skal gjøre når du har problemet – det er ikke sikkert du trenger å finne opp kruttet selv.
						* Du kan ikke "implementere DevOps" eller "lage micro services". Dette er noe som må vokse frem organisk gjennom at et ansvarliggjort team føler på smerter og har lov til å lage løsninger. Ikke bygg platform for å bygge platform!
						* Ikke lag ting før du trenger. Løs faktiske behov, ikke implementer andre sine gode ideer.
						* Synliggjør verdien av IT-oppgavene for andre enn IT. Sparer du penger? Kortere time to market? Vis og bevis det! Har det ingen effekt som er synlig for andre enn IT? Bør du egentlig gjøre det da..?
						* Unngå single point of failures , komponenter som ikke kan deployes uten nedetid
						* Driftsavdeling: inn i utviklingsteamet – eller helt ut
						* Utviklere kan egentlig ikke Ops
						* Overvåkning er vanskelig
						* Har du 24/7 beredskap? Trenger du det? Har du egentlig?
						* Det er omvendt korrelasjon mellom størrelsen på applikasjonen og hvor ofte de kan deployes. Interessant kausalitet, fordi det driver hverandre begge veier.
					</section>

				</section>

				<section id="hovedpoeng">
					<section>
						<ul>
							<li>Gjør én forbedring om gangen</li>
							<li>Løs problemer når du har dem</li>
							<li>Gjør ting enkelt!</li>
						</ul>

						<aside class="notes">
							TODO: Finn ut hvordan vi strukturerer disse. Egne slides per poeng?
							Flette det inn
						</aside>
					</section>
				</section>


				<section id="ideer/backup">
					<ul>
						<li>Øv på feilsituasjoner – firedrills</li>
						<li>Hvor micro er en microservice?</li>
					</ul>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
