<!DOCTYPE html>
<html>

<body>
<video autoplay></video>
<canvas></canvas>
<div></div>
</body>


<script src="http://localhost:1337/socket.io/socket.io.js"></script>
<script src="../lib/webrtc-adapter.js"></script>

<script type="application/javascript">

    var video = document.querySelector('video'),
            canvas = document.querySelector('canvas');

    var socket = io.connect('http://localhost:1337')

    navigator.getUserMedia({video:true, audio: false}, function(stream) {
        video.src = window.URL.createObjectURL(stream);

        createOffer(stream);
    });

    function createOffer(offerStream) {
        var peer = new RTCPeerConnection(iceServerConfig(), []);
        peer.addStream(offerStream);

        peer.createOffer(function(offerSDP) {
            peer.setLocalDescription(offerSDP);

            console.log(offerSDP);

            socket.emit('message', {offer: offerSDP});
        });
    }


    function iceServerConfig() {
        var isChrome = !!navigator.webkitGetUserMedia;
        var STUN = {
            url: isChrome
                    ? 'stun:stun.l.google.com:19302'
                    : 'stun:23.21.150.121'
        };

        var TURN = {
            url: 'turn:homeo@turn.bistri.com:80',
            credential: 'homeo'
        };

        return {
            iceServers: [STUN, TURN]
        };
    }
</script>
</html>